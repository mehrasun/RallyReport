{% extends "base.html" %}

{% block title %}
  {{ jobType }} Job Overview
{% endblock %}

{% block content %}
<h1>ðŸ“Š {{ jobType }} Job Overview</h1>
<div class="card mt-4 shadow-sm">
  <div class="card-header">
    <h5 class="mb-0">Job Runs</h5>
  </div>
  <div class="card-body p-0">
    <table class="table mb-0">
      <thead class="theme-table-header text-left align-middle fs-5">
        <tr>
          <th><i class="bi bi-cpu me-1"></i> Scenario</th>
          <th><i class="bi bi-clock me-1"></i> Last Run</th>
          <th><i class="bi bi-info-circle me-1"></i> Latest Status</th>
          <th><i class="bi bi-bar-chart-steps me-1"></i> Last 5 Builds</th>
          <th><i class="bi bi-terminal me-1"></i> Console Output</th>
          <th><i class="bi bi-file-earmark-code me-1"></i> HTML Report</th>
          <th><i class="bi bi-percent me-1"></i> Success Rate</th>
        </tr>
      </thead>
      <tbody>
      {% if jobs %}
        {% for job in jobs %}
        <tr>
          <td><strong>{{ job.job_name }}</strong></td>
          <td><small class="text-muted">{{ job.last_run }}</small></td>
          <td>
            {% if job.latest_build_status == "SUCCESS" %}
              <span class="badge bg-success">Success</span>
            {% elif job.latest_build_status == "FAILURE" %}
              <span class="badge bg-danger">Failure</span>
            {% elif job.latest_build_status == "ABORTED" %}
              <span class="badge bg-warning text-dark">Aborted</span>
            {% else %}
              <span class="badge bg-secondary">{{ job.latest_build_status }}</span>
            {% endif %}
          </td>
          <td>
            {% for status in job.last_5 %}
              {% if status == "SUCCESS" %}
                <span class="status-dot status-success" title="Success"></span>
              {% elif status == "FAILURE" %}
                <span class="status-dot status-fail" title="Failure"></span>
              {% elif status == "ABORTED" %}
                <span class="status-dot status-aborted" title="Aborted"></span>
              {% endif %}
            {% endfor %}
          </td>
          <td>
            <a href="{{ job.console_url }}" class="btn btn-sm btn-outline-primary" target="_blank">
              Build #{{ job.build_number }}
            </a>
          </td>
          <td>
            <a href="{{ job.report_url }}" class="btn btn-sm btn-outline-info" target="_blank">
              View Report
            </a>
          </td>
          <td style="min-width: 120px;">
            <div class="progress" style="height: 20px;">
              <div class="progress-bar
                {% if job.success_rate == 100 %}
                  bg-success
                {% elif job.success_rate >= 70 %}
                  bg-info
                {% elif job.success_rate >= 40 %}
                  bg-warning
                {% else %}
                  bg-danger
                {% endif %}"
                role="progressbar"
                style="width: {{ job.success_rate }}%; min-width: 2px;"
                aria-valuenow="{{ job.success_rate }}"
                aria-valuemin="0"
                aria-valuemax="100">
                {% if job.success_rate > 5 %}
                  {{ job.success_rate }}%
                {% endif %}
              </div>
              {% if job.success_rate <= 5 %}
                <span class="position-absolute px-1" style="font-size: 0.75rem;">{{ job.success_rate }}%</span>
              {% endif %}
            </div>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted py-4 fw-bold fs-5">
            ðŸš« No jobs are {{ jobType.lower() }} today.
          </td>
        </tr>
      {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}

{% endblock %}